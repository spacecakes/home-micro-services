x-synology-service: &synology-service
  loadBalancer:
    servers:
      - url: "https://10.0.1.2:5001"
    passHostHeader: true

http:
  middlewares:
    # auth:
    #   basicauth:
    #     users:
    #       - '{{env "BASIC_AUTH_USERNAME"}}:{{env "BASIC_AUTH_PASSWORD_HASH"}}'

    default-headers:
      headers:
        frameDeny: true
        sslRedirect: true
        browserXssFilter: true
        contentTypeNosniff: true
        forceSTSHeader: true
        stsIncludeSubdomains: true
        stsPreload: true
        stsSeconds: 31536000

    default-whitelist:
      ipWhiteList:
        sourceRange:
          - '10.0.0.0/24'
          - '192.168.0.0/16'
          - '172.0.0.0/8'

    add-syno-drive-param:
      redirectRegex:
        regex: "^https?://drive\\.app\\.gabriellundmark\\.com/$"
        replacement: "https://drive.app.gabriellundmark.com/?launchApp=SYNO.SDS.Drive.Application"
        permanent: true

  routers:
    global-headers:
      rule: 'HostRegexp(`{any:.+}`)'
      entryPoints:
        - websecure
      middlewares:
        - default-headers
        - default-whitelist
      service: noop@internal

    dsm:
      rule: 'Host(`dsm.app.gabriellundmark.com`)'
      service: synology-dsm

    drive:
      rule: 'Host(`drive.app.gabriellundmark.com`)'
      middlewares:
        - add-syno-drive-param
      service: synology-drive

    unifi:
      rule: 'Host(`unifi.app.gabriellundmark.com`)'
      service: unifi

  services:
    synology-dsm: *synology-service

    synology-drive: *synology-service

    unifi:
      loadBalancer:
        servers:
          - url: 'https://10.0.1.1'
        passHostHeader: true
